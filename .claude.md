# Claude AI Context - SRT-MGATE-1210 Gateway

This file provides context for AI assistants (Claude Code, GitHub Copilot, etc.) working on this project.

## Project Overview

**SRT-MGATE-1210** is an Industrial IoT Gateway built on ESP32-S3 for Modbus RTU/TCP data acquisition with cloud connectivity via MQTT/HTTP. Developed by PT Surya Inovasi Prioritas (SURIOTA).

**Current Version:** 2.2.0
**Developer:** Kemal
**Last Updated:** November 20, 2025

## Quick Facts

- **Platform**: ESP32-S3 (8MB PSRAM, 16MB Flash)
- **IDE**: Arduino IDE 2.0+
- **Language**: C/C++ (Arduino framework)
- **Architecture**: FreeRTOS multi-tasking
- **Protocols**: Modbus RTU/TCP, MQTT, HTTP, BLE
- **License**: MIT

## Repository Structure

```
GatewaySuriotaPOC/
├── Main/                          # Main Arduino sketch
│   └── Main.ino                   # Entry point
├── Documentation/                 # Complete documentation
│   ├── README.md                  # Documentation hub (START HERE!)
│   ├── QUICKSTART.md              # 5-minute setup guide
│   ├── FAQ.md                     # 60+ Q&A
│   ├── GLOSSARY.md                # A-Z terminology
│   ├── BEST_PRACTICES.md          # Production guidelines
│   ├── API_Reference/
│   │   └── API.md                 # BLE CRUD API reference
│   ├── Technical_Guides/
│   │   ├── HARDWARE.md            # GPIO pinout
│   │   ├── PROTOCOL.md            # Communication protocols
│   │   ├── MODBUS_DATATYPES.md    # 40+ data types
│   │   ├── LOGGING.md             # Debug logs
│   │   ├── TROUBLESHOOTING.md     # Common issues
│   │   ├── NETWORK_CONFIGURATION.md # Dual network guide
│   │   ├── MQTT_PUBLISH_MODES_DOCUMENTATION.md
│   │   ├── REGISTER_CALIBRATION_DOCUMENTATION.md
│   │   └── ...
│   ├── Changelog/
│   │   └── VERSION_HISTORY.md     # Complete changelog
│   ├── Archive/                   # Deprecated docs
│   └── Optimizing/                # Performance history
├── README.md                      # Main project README
├── LICENSE                        # MIT License
├── CONTRIBUTING.md                # Contribution guidelines
├── .gitignore                     # Git exclusions
└── .claude.md                     # This file

```

## Key Components (Main/)

The firmware is split into modular components:

### Core Services
- **ModbusRtuService**: Handles 2x RS485 serial ports
- **ModbusTcpService**: Manages TCP Modbus connections
- **MqttManager**: MQTT publish/subscribe with queue
- **HttpManager**: HTTP POST/PUT/PATCH requests
- **BLEManager**: BLE configuration interface

### Configuration & Data
- **ConfigManager**: SD card storage with atomic writes
- **QueueManager**: PSRAM-optimized circular buffer
- **CRUDHandler**: Device/register CRUD operations

### System Management
- **NetworkManager**: Ethernet/WiFi failover
- **ButtonManager**: Mode control (config/production)
- **LEDManager**: Status indicators (NET/STATUS)
- **ErrorHandler**: Unified error codes

## Development Mode

The project has two modes controlled by:

```cpp
#define PRODUCTION_MODE 0  // 0 = Development, 1 = Production
```

**Development Mode** (PRODUCTION_MODE = 0):
- BLE always enabled
- Serial logging verbose
- All debug output active

**Production Mode** (PRODUCTION_MODE = 1):
- BLE disabled (button-activated)
- Serial logging minimal
- Security-focused

## Important Conventions

### File Organization
- **Arduino sketch**: `Main/Main.ino` (entry point)
- **Documentation**: Always in `Documentation/` directory
- **API docs**: `Documentation/API_Reference/API.md`
- **Technical docs**: `Documentation/Technical_Guides/`

### Code Style
- **Naming**: CamelCase for classes, snake_case for variables
- **Comments**: Use `//` for inline, `/* */` for blocks
- **Indentation**: 2 spaces (Arduino standard)
- **Line length**: Max 100 characters

### Documentation Links
- Always use relative paths: `[link](Documentation/API_Reference/API.md)`
- NOT absolute paths or `docs/` (old structure)
- Include breadcrumb navigation in all technical docs

### Version Numbers
- Format: `MAJOR.MINOR.PATCH` (e.g., 2.2.0)
- Update in: README badges, file headers, VERSION_HISTORY.md
- Developer credit: Always include "Kemal" for recent updates

## Common Tasks

### Adding New Documentation
1. Create file in appropriate `Documentation/` subdirectory
2. Add breadcrumb navigation: `[Home](../../README.md) > [Documentation](../README.md) > ...`
3. Add footer: `[← Back to Index](README.md) | [↑ Top](#title)`
4. Update `Documentation/README.md` table of contents
5. Add cross-references in related docs

### Updating API
1. Modify `Main/Main.ino` or service files
2. Update `Documentation/API_Reference/API.md`
3. Add examples to API.md
4. Update VERSION_HISTORY.md changelog
5. Bump version number if needed

### Fixing Documentation Links
- Search for `docs/` → replace with `Documentation/`
- Search for `Docs/` → replace with `Documentation/`
- Verify all links use relative paths

## Testing Workflow

### Hardware Testing
1. Upload firmware via Arduino IDE
2. Open Serial Monitor (115200 baud)
3. Long-press button for BLE config mode
4. Connect via BLE app
5. Send test CRUD commands

### Documentation Testing
1. Check all markdown links work
2. Verify breadcrumbs lead to correct pages
3. Test all code examples (copy-paste to verify syntax)
4. Ensure version numbers are consistent

## Important Files to Update Together

When changing version:
- `README.md` (badges, changelog, dates)
- `Documentation/Changelog/VERSION_HISTORY.md`
- `Main/Main.ino` (header comment)
- All affected documentation files

When adding features:
- Source code files
- `Documentation/API_Reference/API.md`
- `README.md` (features section)
- `Documentation/Changelog/VERSION_HISTORY.md`

When fixing bugs:
- Source code
- `Documentation/Technical_Guides/TROUBLESHOOTING.md`
- `Documentation/Changelog/VERSION_HISTORY.md`

## Git Workflow

### Branch Naming
- Feature: `feature/feature-name`
- Bugfix: `fix/bug-description`
- Documentation: `docs/doc-update`
- Hotfix: `hotfix/critical-fix`

### Commit Message Format
```
type: Brief description

Detailed explanation of changes if needed.

- Change 1
- Change 2
- Change 3

Related: #issue-number
```

**Types**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

### Before Committing
1. Test firmware if code changed
2. Verify all documentation links
3. Check version consistency
4. Run spell check on docs
5. Update changelog if needed

## Dependencies

### Arduino Libraries (see Documentation/Technical_Guides/LIBRARIES.md)
- ArduinoJson (v7.4.2+)
- RTClib (v2.1.4+)
- NTPClient (v3.2.1+)
- Ethernet (v2.0.2+)
- TBPubSubClient (v2.12.1+)
- ModbusMaster (v2.0.1+)
- OneButton (v2.0+)

### Hardware
- ESP32-S3 Dev Module
- W5500 Ethernet module
- DS3231 RTC
- 2x RS485 transceivers
- LEDs and button

## Troubleshooting AI Development

### Common Issues

**"File not found" errors:**
- Check you're using `Documentation/` not `docs/`
- Use relative paths, not absolute
- Verify file exists with correct case (case-sensitive)

**Version mismatch:**
- Update README.md badge
- Update VERSION_HISTORY.md
- Check all file headers

**Broken links:**
- Search for old `docs/` paths
- Replace with `Documentation/`
- Test all links in markdown preview

**Code compilation errors:**
- Verify ESP32 board package installed
- Check all library versions
- Review serial output for details

## Resources

### Essential Documentation
- **Start Here**: [Documentation/README.md](Documentation/README.md)
- **Quick Setup**: [Documentation/QUICKSTART.md](Documentation/QUICKSTART.md)
- **API Reference**: [Documentation/API_Reference/API.md](Documentation/API_Reference/API.md)
- **Troubleshooting**: [Documentation/Technical_Guides/TROUBLESHOOTING.md](Documentation/Technical_Guides/TROUBLESHOOTING.md)

### External Links
- **ESP32 Arduino Core**: https://github.com/espressif/arduino-esp32
- **Arduino IDE**: https://www.arduino.cc/en/software
- **GitHub Repo**: https://github.com/GifariKemal/GatewaySuriotaPOC

## Contact & Support

**Developer:** Kemal (SURIOTA R&D Team)
**Company:** PT Surya Inovasi Prioritas (SURIOTA)
**Support Email:** support@suriota.com
**Website:** www.suriota.com

## Notes for AI Assistants

### When Updating Documentation:
1. ✅ Always check existing file structure first
2. ✅ Use consistent breadcrumb navigation
3. ✅ Update cross-references in related docs
4. ✅ Maintain 100% English language
5. ✅ Include document metadata (version, date, firmware)
6. ✅ Add footer navigation (back/top links)

### When Writing Code:
1. ✅ Follow Arduino framework conventions
2. ✅ Use FreeRTOS patterns for tasks
3. ✅ Add comprehensive comments
4. ✅ Include error handling
5. ✅ Update API documentation

### When Fixing Issues:
1. ✅ Check TROUBLESHOOTING.md first
2. ✅ Verify hardware connections
3. ✅ Review serial monitor output
4. ✅ Test in both Development and Production modes
5. ✅ Document the fix in VERSION_HISTORY.md

---

**Last Updated:** November 20, 2025 by Kemal
**Version:** 2.2.0
